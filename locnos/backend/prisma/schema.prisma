// Arquivo de schema do Prisma para Supabase (PostgreSQL)
// Gera os modelos de dados e o cliente Prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== USUÁRIOS =====
model User {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Informações básicas
  name     String
  email    String   @unique
  password String   // Hash bcrypt
  role     UserRole @default(CUSTOMER)

  // Contato
  phone    String?
  whatsapp String?

  // Documentos (Brasil)
  documentType   DocumentType
  documentNumber String       @unique
  documentVerified Boolean @default(false)

  // Endereço
  addressStreet      String?
  addressNumber      String?
  addressComplement  String?
  addressNeighborhood String?
  addressCity        String?
  addressState       String?
  addressZipCode     String?
  addressCountry     String? @default("Brasil")

  // Empresa (para CNPJ)
  companyName                 String?
  companyTradeName            String?
  companyStateRegistration    String?
  companyMunicipalRegistration String?

  // Status
  status UserStatus @default(PENDING)

  // Permissões (array JSON para flexibilidade)
  permissions String[] @default([])

  // Localização/filial
  locationId String?
  location   Location? @relation(fields: [locationId], references: [id])

  // Dados do cliente
  creditLimit  Decimal  @default(0) @db.Decimal(10, 2)
  totalRented  Int      @default(0)
  totalSpent   Decimal  @default(0) @db.Decimal(10, 2)
  lastRental   DateTime?
  notes        String?
  rating       Int?     @db.SmallInt

  // Avatar
  avatar String?

  // Senha reset
  resetPasswordToken  String?
  resetPasswordExpire DateTime?

  // Último login
  lastLogin DateTime?

  // Relacionamentos
  contracts       Contract[]
  payments        Payment[]
  createdEquipment Equipment[] @relation("CreatedBy")
  updatedEquipment Equipment[] @relation("UpdatedBy")
  createdContracts Contract[] @relation("CreatedBy")
  approvedContracts Contract[] @relation("ApprovedBy")

  @@index([email])
  @@index([documentNumber])
  @@index([role, status])
  @@map("usuarios")
}

// ... (enums unchanged)

// ===== CATEGORIAS =====
model Category {
  // ... (fields unchanged)
  @@map("categorias")
}

// ===== EQUIPAMENTOS =====
model Equipment {
  // ... (fields unchanged)
  @@map("equipamentos")
}

// ===== CONTRATOS =====
model Contract {
  // ... (fields unchanged)
  @@map("contratos")
}

// ===== ITENS DO CONTRATO =====
model ContractItem {
  // ... (fields unchanged)
  @@map("itens_contrato")
}

// ===== PAGAMENTOS =====
model Payment {
  // ... (fields unchanged)
  @@map("pagamentos")
}

// ===== MANUTENÇÃO =====
model Maintenance {
  // ... (fields unchanged)
  @@map("manutencoes")
}

// ===== LOCALIZAÇÕES/FILIAIS =====
model Location {
  // ... (fields unchanged)
  @@map("locais")
}
